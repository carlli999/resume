总结
	•	数据库 结构灵活支持所有时间、状态、页面控制
	•	后端 /api/notice.php 动态判断显示状态和时间，返回 JSON
	•	后台管理 /admin/notice_edit.php 带多选页面复选框，方便管理通知显示范围
	•	前端 JS 自动加载通知，按页面过滤，UI 简洁
	•	所有页面只需加入一段 DIV + JS 即可显示通知


⸻
'''
1. 数据库结构（MySQL）

CREATE TABLE IF NOT EXISTS notices (
    id INT AUTO_INCREMENT PRIMARY KEY,
    title VARCHAR(255) NOT NULL,
    content TEXT NOT NULL,
    title_en VARCHAR(255) DEFAULT NULL,
    content_en TEXT DEFAULT NULL,
    title_fr VARCHAR(255) DEFAULT NULL,
    content_fr TEXT DEFAULT NULL,
    style VARCHAR(20) DEFAULT 'warning',
    enabled TINYINT(1) DEFAULT 1,
    start_at DATETIME DEFAULT NULL,
    expire_at DATETIME DEFAULT NULL,
    never_expire TINYINT(1) DEFAULT 0,
    allowed_pages TEXT DEFAULT NULL,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS audit_logs (
    id INT AUTO_INCREMENT PRIMARY KEY,
    notice_id INT NOT NULL,
    user VARCHAR(100) NOT NULL,
    changed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    old_data TEXT,
    new_data TEXT,
    FOREIGN KEY (notice_id) REFERENCES notices(id) ON DELETE CASCADE
);

'''
⸻

2. API接口 /api/notice.php

<?php
header('Content-Type: application/json; charset=utf-8');

$lang = $_GET['lang'] ?? 'zh';
$lang = in_array($lang, ['zh', 'en', 'fr']) ? $lang : 'zh';

try {
    $pdo = new PDO(
        "mysql:host=localhost;dbname=yourdb;charset=utf8",
        "dbuser",
        "dbpass",
        [PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION]
    );

    $sql = "SELECT * FROM notices WHERE enabled = 1 ORDER BY updated_at DESC LIMIT 1";
    $stmt = $pdo->query($sql);
    $data = $stmt->fetch(PDO::FETCH_ASSOC);

    if (!$data) {
        echo json_encode(['enabled' => false]);
        exit;
    }

    $now = time();

    if (!empty($data['start_at']) && $now < strtotime($data['start_at'])) {
        echo json_encode(['enabled' => false]);
        exit;
    }

    if (!$data['never_expire']) {
        if (!empty($data['expire_at']) && $now > strtotime($data['expire_at'])) {
            echo json_encode(['enabled' => false]);
            exit;
        }
    }

    switch ($lang) {
        case 'en':
            $data['title'] = $data['title_en'] ?: $data['title'];
            $data['content'] = $data['content_en'] ?: $data['content'];
            break;
        case 'fr':
            $data['title'] = $data['title_fr'] ?: $data['title'];
            $data['content'] = $data['content_fr'] ?: $data['content'];
            break;
        default:
            // zh 默认
            break;
    }

    unset($data['title_en'], $data['content_en'], $data['title_fr'], $data['content_fr']);

    echo json_encode($data, JSON_UNESCAPED_UNICODE);

} catch (PDOException $e) {
    echo json_encode(['enabled' => false, 'error' => '数据库错误']);
}


⸻

3. 后台管理 /admin/notice_edit.php

<?php
session_start();
$user = $_SESSION['username'] ?? '未知用户';

try {
    $pdo = new PDO(
        "mysql:host=localhost;dbname=yourdb;charset=utf8",
        "dbuser",
        "dbpass",
        [PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION]
    );
} catch (PDOException $e) {
    die("数据库连接失败");
}

$allPages = [
    "index.html",
    "default.html",
    "about.html",
    "contact.html",
    "news.html",
    "help.html"
];

$stmt = $pdo->query("SELECT * FROM notices LIMIT 1");
$n = $stmt->fetch(PDO::FETCH_ASSOC);

if (!$n) {
    $n = [
        'id' => null,
        'title' => '',
        'content' => '',
        'title_en' => '',
        'content_en' => '',
        'title_fr' => '',
        'content_fr' => '',
        'style' => 'warning',
        'enabled' => 0,
        'start_at' => '',
        'expire_at' => '',
        'never_expire' => 0,
        'allowed_pages' => null
    ];
}

if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $title_zh = $_POST['title_zh'] ?? '';
    $content_zh = $_POST['content_zh'] ?? '';
    $title_en = $_POST['title_en'] ?? '';
    $content_en = $_POST['content_en'] ?? '';
    $title_fr = $_POST['title_fr'] ?? '';
    $content_fr = $_POST['content_fr'] ?? '';
    $style = $_POST['style'] ?? 'warning';
    $enabled = isset($_POST['enabled']) ? intval($_POST['enabled']) : 0;
    $start_at = $_POST['start_at'] ?: null;
    $expire_at = $_POST['expire_at'] ?: null;
    $never_expire = isset($_POST['never_expire']) ? 1 : 0;
    $pages = $_POST['allowed_pages'] ?? [];
    $allowed_pages = $pages ? json_encode($pages) : null;

    if ($n['id']) {
        $stmt = $pdo->prepare("SELECT * FROM notices WHERE id=:id");
        $stmt->execute([':id' => $n['id']]);
        $oldNotice = $stmt->fetch(PDO::FETCH_ASSOC);

        $sql = "UPDATE notices SET
            title=:title_zh,
            content=:content_zh,
            title_en=:title_en,
            content_en=:content_en,
            title_fr=:title_fr,
            content_fr=:content_fr,
            style=:style,
            enabled=:enabled,
            start_at=:start_at,
            expire_at=:expire_at,
            never_expire=:never_expire,
            allowed_pages=:allowed_pages
            WHERE id=:id";

        $stmt = $pdo->prepare($sql);
        $stmt->execute([
            ':title_zh' => $title_zh,
            ':content_zh' => $content_zh,
            ':title_en' => $title_en,
            ':content_en' => $content_en,
            ':title_fr' => $title_fr,
            ':content_fr' => $content_fr,
            ':style' => $style,
            ':enabled' => $enabled,
            ':start_at' => $start_at,
            ':expire_at' => $expire_at,
            ':never_expire' => $never_expire,
            ':allowed_pages' => $allowed_pages,
            ':id' => $n['id']
        ]);

        $newNotice = [
            'title' => $title_zh,
            'content' => $content_zh,
            'title_en' => $title_en,
            'content_en' => $content_en,
            'title_fr' => $title_fr,
            'content_fr' => $content_fr,
            'style' => $style,
            'enabled' => $enabled,
            'start_at' => $start_at,
            'expire_at' => $expire_at,
            'never_expire' => $never_expire,
            'allowed_pages' => $allowed_pages,
        ];

        $auditSql = "INSERT INTO audit_logs 
            (notice_id, user, old_data, new_data)
            VALUES (:notice_id, :user, :old_data, :new_data)";
        $auditStmt = $pdo->prepare($auditSql);
        $auditStmt->execute([
            ':notice_id' => $n['id'],
            ':user' => $user,
            ':old_data' => json_encode($oldNotice, JSON_UNESCAPED_UNICODE),
            ':new_data' => json_encode($newNotice, JSON_UNESCAPED_UNICODE)
        ]);
    } else {
        $sql = "INSERT INTO notices
            (title, content, title_en, content_en, title_fr, content_fr, style, enabled, start_at, expire_at, never_expire, allowed_pages)
            VALUES
            (:title_zh, :content_zh, :title_en, :content_en, :title_fr, :content_fr, :style, :enabled, :start_at, :expire_at, :never_expire, :allowed_pages)";
        $stmt = $pdo->prepare($sql);
        $stmt->execute([
            ':title_zh' => $title_zh,
            ':content_zh' => $content_zh,
            ':title_en' => $title_en,
            ':content_en' => $content_en,
            ':title_fr' => $title_fr,
            ':content_fr' => $content_fr,
            ':style' => $style,
            ':enabled' => $enabled,
            ':start_at' => $start_at,
            ':expire_at' => $expire_at,
            ':never_expire' => $never_expire,
            ':allowed_pages' => $allowed_pages
        ]);
        $newId = $pdo->lastInsertId();

        $auditSql = "INSERT INTO audit_logs 
            (notice_id, user, old_data, new_data)
            VALUES (:notice_id, :user, :old_data, :new_data)";
        $auditStmt = $pdo->prepare($auditSql);
        $auditStmt->execute([
            ':notice_id' => $newId,
            ':user' => $user,
            ':old_data' => null,
            ':new_data' => json_encode([
                'title' => $title_zh,
                'content' => $content_zh,
                'title_en' => $title_en,
                'content_en' => $content_en,
                'title_fr' => $title_fr,
                'content_fr' => $content_fr,
                'style' => $style,
                'enabled' => $enabled,
                'start_at' => $start_at,
                'expire_at' => $expire_at,
                'never_expire' => $never_expire,
                'allowed_pages' => $allowed_pages
            ], JSON_UNESCAPED_UNICODE)
        ]);
    }

    echo "<p style='color:green;'>保存成功！</p>";

    $stmt = $pdo->query("SELECT * FROM notices LIMIT 1");
    $n = $stmt->fetch(PDO::FETCH_ASSOC);
}

$currentPages = json_decode($n['allowed_pages'] ?? '[]', true);
if (!is_array($currentPages)) $currentPages = [];

?>

<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>通知管理后台</title>
    <style>
      label { font-weight: bold; }
      textarea { resize: vertical; }
      .lang-block { border: 1px solid #ccc; margin: 10px 0; padding: 10px; }
    </style>
</head>
<body>
    <h1>通知管理</h1>

    <form method="post">

        <div class="lang-block">
          <h3>中文通知</h3>
          <label>标题：</label><br>
          <input type="text" name="title_zh" value="<?= htmlspecialchars($n['title'] ?? '') ?>" style="width:300px;"><br>
          <label>内容：</label><br>
          <textarea name="content_zh" style="width:300px; height:80px;"><?= htmlspecialchars($n['content'] ?? '') ?></textarea>
        </div>

        <div class="lang-block">
          <h3>English Notice</h3>
          <label>Title:</label><br>
          <input type="text" name="title_en" value="<?= htmlspecialchars($n['title_en'] ?? '') ?>" style="width:300px;"><br>
          <label>Content:</label><br>
          <textarea name="content_en" style="width:300px; height:80px;"><?= htmlspecialchars($n['content_en'] ?? '') ?></textarea>
        </div>

        <div class="lang-block">
          <h3>Français</h3>
          <label>Titre :</label><br>
          <input type="text" name="title_fr" value="<?= htmlspecialchars($n['title_fr'] ?? '') ?>" style="width:300px;"><br>
          <label>Contenu :</label><br>
          <textarea name="content_fr" style="width:300px; height:80px;"><?= htmlspecialchars($n['content_fr'] ?? '') ?></textarea>
        </div>

        <label>类型：</label><br>
        <select name="style">
            <option value="warning" <?= $n['style']=='warning' ? 'selected' : '' ?>>警告</option>
            <option value="info" <?= $n['style']=='info' ? 'selected' : '' ?>>提示</option>
            <option value="error" <?= $n['style']=='error' ? 'selected' : '' ?>>错误</option>
            <option value="success" <?= $n['style']=='success' ? 'selected' : '' ?>>成功</option>
        </select>
        <br><br>

        <label>开始时间：</label><br>
        <input type="datetime-local" name="start_at" value="<?= $n['start_at'] ? str_replace(' ', 'T', $n['start_at']) : '' ?>"><br><br>

        <label>永不过期：</label>
        <input type="checkbox" name="never_expire" <?= $n['never_expire'] ? 'checked' : '' ?>><br><br>

        <label>结束时间（永不过期时忽略）：</label><br>
        <input type="datetime-local" name="expire_at" value="<?= $n['expire_at'] ? str_replace(' ', 'T', $n['expire_at']) : '' ?>"><br><br>

        <label>启用：</label><br>
        <select name="enabled">
            <option value="1" <?= $n['enabled']==1 ? 'selected' : '' ?>>启用</option>
            <option value="0" <?= $n['enabled']==0 ? 'selected' : '' ?>>禁用</option>
        </select>
        <br><br>

        <label><strong>显示页面（勾选则只在选中页面显示，不勾选则全部页面显示）：</strong></label><br>
        <?php foreach ($allPages as $page): ?>
            <label>
                <input type="checkbox" name="allowed_pages[]" value="<?= $page ?>" 
                    <?= in_array($page, $currentPages) ? 'checked' : '' ?>>
                <?= $page ?>
            </label><br>
        <?php endforeach; ?>

        <br>
        <button type="submit">保存通知</button>
    </form>
</body>
</html>


⸻

4. 前端通知加载脚本 /assets/notice.js

(function() {
    const box = document.getElementById('notice-box');
    if (!box) return;

    const currentPage = location.pathname.split('/').pop() || "index.html";
    const lang = window.siteLang || 'zh';

    fetch(`/api/notice.php?lang=${encodeURIComponent(lang)}&_=${Date.now()}`)
        .then(res => res.json())
        .then(data => {
            if (!data.enabled) return;

            if (data.allowed_pages) {
                let allowed = [];
                try {
                    allowed = JSON.parse(data.allowed_pages);
                } catch(e) {
                    allowed = [];
                }
                if (allowed.length > 0 && !allowed.includes(currentPage)) {
                    return;
                }
            }

            const colorMap = {
                warning: "#fff3cd",
                info: "#cfe2ff",
                error: "#f8d7da",
                success: "#d1e7dd"
            };

            box.innerHTML = `
              <div style="
                background:${colorMap[data.style] || '#e2e3e5'};
                padding: 12px;
                border-left: 4px solid #00000030;
                margin: 15px 0;
                border-radius: 4px;
                font-family: Arial, sans-serif;
              ">
                <strong>${data.title}</strong><br>
                ${data.content}
              </div>
            `;
        })
        .catch(err => console.error("通知加载失败", err));
})();


⸻

5. 页面中调用示例（任意HTML文件）

<!-- 页面里 -->
<script>
  // 设置当前语言，支持 'zh', 'en', 'fr'
  window.siteLang = 'en';
</script>

<div id="notice-box"></div>
<script src="/assets/notice.js"></script>


⸻

6. 审计日志查看 /admin/audit_logs.php

<?php
session_start();

try {
    $pdo = new PDO(
        "mysql:host=localhost;dbname=yourdb;charset=utf8",
        "dbuser",
        "dbpass",
        [PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION]
    );

    $stmt = $pdo->query("SELECT * FROM audit_logs ORDER BY changed_at DESC LIMIT 50");
    $logs = $stmt->fetchAll(PDO::FETCH_ASSOC);

} catch (PDOException $e) {
    die("数据库连接失败");
}
?>

<!DOCTYPE html>
<html lang="zh-CN">
<head><meta charset="UTF-8"><title>通知修改日志</title></head>
<body>
<h1>通知修改审计日志（最近50条）</h1>
<table border="1" cellpadding="5" cellspacing="0" style="border-collapse:collapse;">
    <thead>
        <tr>
            <th>ID</th>
            <th>通知ID</th>
            <th>修改用户</th>
            <th>修改时间</th>
            <th>修改前内容</th>
            <th>修改后内容</th>
        </tr>
    </thead>
    <tbody>
    <?php foreach($logs as $log): ?>
        <tr>
            <td><?= $log['id'] ?></td>
            <td><?= $log['notice_id'] ?></td>
            <td><?= htmlspecialchars($log['user']) ?></td>
            <td><?= $log['changed_at'] ?></td>
            <td><pre style="max-height:150px; overflow:auto;"><?= htmlspecialchars($log['old_data']) ?></pre></td>
            <td><pre style="max-height:150px; overflow:auto;"><?= htmlspecialchars($log['new_data']) ?></pre></td>
        </tr>
    <?php endforeach; ?>
    </tbody>
</table>
</body>
</html>


⸻

注意事项
	•	请根据